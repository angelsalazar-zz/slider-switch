<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="highlight-behavior.html">

<dom-module id="slider-switch">
   <template>
     <style>
         :host {
             display: block;
         }
         .switch{
             position: absolute;
             margin-left: -5px;
             height: 100%;
             width: 10px;
             stroke: #90CAF9;
             stroke-width: 2;
             fill: #90CAF9;
         }
         .switch:hover{
             stroke: #1565C0;
             fill: #1565C0;
         }

         .highlighted {
           stroke: #FF9800;
           fill: #FF9800;
         }
    </style>
    <svg class$="switch {{class}}" style$="left:{{position}}px">
        <polygon points$="{{points}}" />
    </svg>
  </template>
   <script>
       Polymer({
           is: 'slider-switch',
           behaviors: [HighlightBehavior],
           listeners: {
               down: '_handleDown'
           },
           properties:{
               position: {
                   type: Number,
                   value: 0,
                   reflectToAttribute: true
               },
               isDragging: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },
               isSelected: {
                   type: Boolean,
                   value: false,
                   reflectToAttribute: true
               },
               _startX:{
                   type: Number,
                   value: 0
               },
               index:{
                   type:Number,
                   reflectToAttribute: true
               }
           },
           _handleDown: function(e){
                this._startX = e.detail.x;
                this.listen(this, 'track', '_handleMove');
                this.listen(this, 'up', '_handleUp');
            },
           _handleMove: function(e){
               var deltaX = e.detail.x - this._startX;
               var _children = Polymer.dom(Polymer.dom(this).parentNode).querySelectorAll("slider-switch");
               for(var i=0;i<_children.length;i++){
                   if(_children[i].isSelected){
                       if(!_children[i].isDragging){
                           _children[i].isDragging = true;
                        }
                        var x = _children[i].position;
                       //if((x + deltaX) >= 0 && (x + deltaX)<= $(e.currentTarget).width())
                        _children[i].position = x + deltaX;
                   }
               }
               this._startX = e.detail.x;
            },
           _handleUp: function(e){
               var _children = Polymer.dom(Polymer.dom(this).parentNode).querySelectorAll("slider-switch");
               for(var i=0;i<_children.length;i++){
                   if(_children[i].isDragging){
                       _children[i].isDragging = false;
                   }
               }
               this.unlisten(this, 'track', '_handleMove');
               this.unlisten(this, 'up', '_handleUp');
            }
       });
  </script>
</dom-module>

